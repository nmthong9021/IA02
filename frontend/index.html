<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/v/bs4/dt-1.10.24/datatables.min.css"
    />
  </head>
  <style>
    .bigtext {
      font-size: 1.25rem;
    }
  </style>
  <body>
    <div class="container mt-5">
      <div class="row">
        <div class="col-sm-12">
          <div class="card shadow">
            <div class="card-header">
              <h3>CRUD for Country</h3>
            </div>
            <div class="card-header pt-4">
              <button
                type="button"
                class="btn btn-outline-success shadow bigtext"
                id="btnLoad"
              >
                <i class="fa fa-refresh" aria-hidden="true"> Load</i>
              </button>

              <button
                type="button"
                class="btn btn-outline-primary ml-3 shadow bigtext"
                id="btnAdd"
                data-toggle="modal"
                data-target="#addModal"
              >
                <i class="fa fa-plus" aria-hidden="true"> Add</i>
              </button>
            </div>
            <div class="card-body">
              <table class="table table-hover text-center" id="table_id">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Country</th>
                    <th scope="col">Last Update</th>
                    <th scope="col">Action</th>
                  </tr>
                </thead>
                <tbody id="table_body_id">
                  <!-- <tr>
                    <th scope="row">1</th>
                    <td>Vietnam</td>
                    <td>6/4/2021</td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-outline-warning"
                        id="btnEdit1"
                      >
                        <i class="fa fa-pencil-square-o" aria-hidden="true"
                          >Edit</i
                        >
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        id="btnDelete1"
                      >
                        <i class="fa fa-trash" aria-hidden="true">Delete</i>
                      </button>
                    </td>
                  </tr> -->
                </tbody>
              </table>
            </div>
            <div class="card-footer text-muted">nmthong9021, 6/4/2021</div>
          </div>
        </div>
      </div>
    </div>

    <div id="addModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Add country</h3>
            <a class="close" data-dismiss="modal">
              <i class="fa fa-times" aria-hidden="true"></i>
            </a>
          </div>
          <form id="contactForm" name="contact" role="form">
            <div class="modal-body">
              <div class="form-group">
                <label for="name">Country name: </label>
                <input
                  type="text"
                  name="name"
                  class="form-control"
                  placeholder=""
                  autofocus
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-success"
                data-dismiss="modal"
                id="btnSubmit"
              >
                Add
              </button>
              <button
                type="button"
                class="btn btn-default ml-2"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit modal-->
    <div id="editModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit country</h3>
            <a class="close" data-dismiss="modal">
              <i class="fa fa-times" aria-hidden="true"></i>
            </a>
          </div>
          <form id="frmEdit" name="frmEdit" role="form">
            <div class="modal-body">
              <div class="form-group">
                <label for="name">Country id: </label>
                <input
                  type="text"
                  id="txtId"
                  name="txtId"
                  class="form-control"
                  placeholder=""
                  readonly
                />
              </div>
              <div class="form-group">
                <label for="name">Country name: </label>
                <input
                  type="text"
                  id="txtName"
                  name="txtName"
                  class="form-control"
                  placeholder=""
                  autofocus
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-success"
                data-dismiss="modal"
                id="btnEdit"
              >
                Edit
              </button>
              <button
                type="button"
                class="btn btn-default ml-2"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete -->
    <!-- Delete modal-->
    <div id="deleteModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Delete country</h3>
            <a class="close" data-dismiss="modal">
              <i class="fa fa-times" aria-hidden="true"></i>
            </a>
          </div>
          <form id="frmDelete" name="frmDelete" role="form">
            <div class="modal-body">
              <div class="form-group">
                <label for="name">Country id: </label>
                <input
                  type="text"
                  id="txtId1"
                  name="txtId1"
                  class="form-control"
                  placeholder=""
                  readonly
                />
              </div>
              <div class="form-group">
                <label for="name">Country name: </label>
                <input
                  type="text"
                  id="txtName1"
                  name="txtName1"
                  class="form-control"
                  placeholder=""
                  readonly
                />
              </div>
            </div>
            <div class="modal-footer">
              <span class="text-danger font-weight-bold mb-1">Bạn có thực sự muốn xóa ?</p>
              <button
                type="button"
                class="btn btn-danger"
                data-dismiss="modal"
                id="btnDelete"
              >
                Delete
              </button>
              <button
                type="button"
                class="btn btn-default ml-2"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/bs4/dt-1.10.24/datatables.min.js"
    ></script>

    <script>
      $(document).ready(function () {
        const arrayCountryName = [];

        // hàm load
        function load() {
          // xóa sạch bảng cũ :
          $("#table_body_id").empty();
          arrayCountryName.length = 0;

          // $.ajax({
          //   url: "http://localhost:5000/api/v1/country",
          //   type: "GET",
          //   success: function (data) {
          //     console.log(data);
          //   },
          //   error: function (error) {
          //     console.log(error);
          //   },
          // });
          $.ajax({
            url: "http://localhost:5000/api/v1/country",
            type: "GET",
          }).done(function (data) {
            for (let i = 0; i < data.length; i++) {
              const row = `<tr>
                    <th scope="row">${data[i].country_id}</th>
                    <td>${data[i].country}</td>
                    <td>6/4/2021${data[i].last_update}</td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-outline-warning"
                        id="btnEdit${data[i].country_id}"
                        data-toggle="modal"
                        data-target="#editModal"
                      >
                        <i class="fa fa-pencil-square-o" aria-hidden="true"
                          > Edit</i
                        >
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        id="btnDelete${data[i].country_id}"
                        data-toggle="modal"
                        data-target="#deleteModal"
                      >
                        <i class="fa fa-trash" aria-hidden="true"> Delete</i>
                      </button>
                    </td>
                  </tr>`;

              $("#table_body_id").append(row);
              arrayCountryName.push(data[i].country);
            }

            //$("#table_id").DataTable();
          });
        }

        // $("#btnLoad").on("click", function () {
        //    load();
        // });

        document.getElementById("btnLoad").addEventListener("click", load);

        // add
        $("#btnSubmit").on("click", function () {
          const data = {
            country: document.querySelector('#addModal input[name="name"]')
              .value,
          };
          const jsonData = JSON.stringify(data);
          console.log(jsonData);

          $.ajax({
            url: "http://localhost:5000/api/v1/country",
            type: "POST",
            dataType: "json",
            data: jsonData,
            contentType: "application/json",
            success: function (response) {
              console.log(response);
              Swal.fire({
                title: "Successful !",
                text: "Add Sucess",
                icon: "",
                confirmButtonText: "Cool",
              });
            },
            error: function () {
              Swal.fire({
                title: "Error!",
                text: "Check again",
                icon: "error",
                confirmButtonText: "Bad",
              });
            },
          });
        });

        // edit
        // search : set/pass value to modal
        $("#editModal").on("show.bs.modal", function (e) {
          const btnId = e.relatedTarget.id; // nếu button.onlick thì là e.target
          const id = +btnId.slice(7);
          document.getElementById("txtId").value = id;
          document.getElementById("txtName").value = arrayCountryName[id - 1];
        });

        $("#btnEdit").on("click", function (e) {
          const id = document.getElementById("txtId").value; 
            const data = {
              country: document.querySelector('#editModal input[id="txtName"]')
                .value,
            };
            const jsonData = JSON.stringify(data);
            console.log(jsonData);

            $.ajax({
              url: `http://localhost:5000/api/v1/country/${id}`,
              type: "PUT",
              dataType: "json",
              data: jsonData,
              contentType: "application/json",
              success: function (response) {
                console.log(response);
                Swal.fire({
                  title: "Successful !",
                  text: "Edit Sucess",
                  icon: "",
                  confirmButtonText: "Cool",
                });
                load();
              },
              error: function () {
                Swal.fire({
                  title: "Error!",
                  text: "Check again",
                  icon: "error",
                  confirmButtonText: "Bad",
                });
              },
            });
          });

          

          //Delete 
          $("#deleteModal").on("show.bs.modal", function (e) {
          const btnId = e.relatedTarget.id; // nếu button.onlick thì là e.target

          const id = +btnId.slice(9);  
          document.getElementById("txtId1").value = id;
          document.getElementById("txtName1").value = arrayCountryName[id - 1];
        });

        $("#btnDelete").on("click", function (e) {
          const id = document.getElementById("txtId1").value; 

            $.ajax({
              url: `http://localhost:5000/api/v1/country/${id}`,
              type: "DELETE",
              success: function (response) {
                console.log(response);
                Swal.fire({
                  title: "Successful !",
                  text: "Delete Sucess",
                  icon: "",
                  confirmButtonText: "Cool",
                });
                load();
              },
              error: function () {
                Swal.fire({
                  title: "Error!",
                  text: "Check again",
                  icon: "error",
                  confirmButtonText: "Bad",
                });
              },
            });
          });



      });
    </script>
  </body>
</html>
